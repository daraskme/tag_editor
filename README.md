# AI Tag Editor

シンプルなGUIで画像フォルダ内のタグテキスト（`.txt`）を編集できるツールです。
さらに、ローカルAI（WD Tagger & Florence-2）を統合しており、Danbooru形式のタグや詳細な自然言語キャプションを画像から自動抽出してテキストファイルに直接追加・保存することができます。

## 推奨環境
- Linux または Windows
- Python 3.10以上
- GPU (CUDA) 環境を強く推奨しますが、CPU環境でも動作可能です。

## 機能
- **フォルダ読み込み**: 指定したフォルダ内の画像（png, jpg, jpeg, webp）と対応するテキストファイルをリストアップします。
- **タグの閲覧・編集**: 画像に関連付けられたタグをボタン化して分かりやすく表示します。右側の青いボタンをクリックするだけで削除できます。
- **タグの新規追加**: テキストボックスに新しいタグを入力し、現在の画像にワンクリックで追加できます。
- **一括操作**: `[Add to All]` や `[Remove from All]` を使うことで、フォルダ内の全てのテキストファイルに対してタグを一括追加・削除できます。
- **AIによる自動タグ付け**:
  - **Run WD Tagger**: `SmilingWolf/wd-vit-tagger-v3` モデルを使用して、アニメ・イラスト向けの正確なDanbooru/e621タグを自動抽出します。
  - **Run Florence-2**: `microsoft/Florence-2-large` モデルを使用して、画像の詳細な説明文（キャプション）を自動生成します。

## インストールと起動
### Linux
```bash
# ターミナルで実行
cd tag_editor
chmod +x run.sh
./run.sh
```

### Windows
フォルダ内にある `run.bat` をダブルクリックして実行してください。

※ 初回起動時は仮想環境（`venv`）の作成と必要なPythonライブラリのインストールが行われるため、数分かかる場合があります。

## AIモデルの初回ダウンロードについて
「Run WD Tagger」または「Run Florence-2」ボタンを初めてクリックした際、Hugging Faceから自動的にAIモデル本体のダウンロードが開始されます。これにはネットワーク環境にもよりますがある程度の時間（数分〜）がかかります。
進捗状況はアプリケーションウィンドウ下部のステータスバーに表示されます。

## AIの実行環境（GPU/CPU）
このアプリケーションは起動時にシステムのPyTorch/ONNX環境をチェックします。
CUDAが利用可能なNVIDIA GPUが搭載されている環境であれば自動的にGPU（`float16` または `CUDAExecutionProvider`）を使用して高速に推論を実行します。
GPUが検知されない環境では、自動的にCPUモードで動作します（推論には時間がかかります）。
